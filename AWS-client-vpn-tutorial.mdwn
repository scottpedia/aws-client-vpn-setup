# Create Your Private OpenVPN Service with AWS Client VPN Endpoint

In this article, I am going to teach you how to create your own private OpenVPN service with AWS Client VPN Endpoint.

## What are AWS and AWS Client VPN Endpoint?

Amazon Web Service(AWS) is a cloud computing platform by Amazon founded in 2006. It is now one of the largest and most popular cloud computing platforms in the world. It provides a variety of services like Virtual Machine, Managed Database, etc.

One of the services being provided by AWS is Client VPN Endpoint. It helps to create an endpoint to which you can directly access the resources(like virtual machines) within a VPC via an OpenVPN connection to the designated subnet.

**However, with some modifications to the configuration, we can turn that service into a working VPN server that allows us to anonymously access the public internet with** ***incredible performance!*** The figure below briefly explains how the client VPN endpoint intends to work.   

![how aws client vpn endpoint works](https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/images/architecture.png)

## Step 1 : Create an AWS Account

> If you already have a working AWS account, you can skip to [Step 3](#Step-4-:-Navigate-to-Client-VPN-Endpoint).

So the first step would be creating an AWS account. We need to have a working AWS account to create resources on the platform. Go to [the sign-up website](https://portal.aws.amazon.com/billing/signup#/start) to create a free account. 

![the sign-up website](aws-signup.png)

> Note that by creating a free AWS account, you are automatically granted free access to some of its services for the first year following the sign-up date. Go to [this page](https://aws.amazon.com/free) to get more information. Fill in the information forms as instructed. 

## Step 2 : Sign in to the Console with your AWS account

Sign in to the AWS Management Console with the account you just created on [on this page](https://console.aws.amazon.com/). Select **"Root User"** and enter the email address, then click "Next". Enter the password on the following page and click "Sign in".

![the sign-in page](aws-signin.png)

You should be on this page after signing in. This is the main page of the AWS Management Console where you can find the index of all the services on this platform.

![AWS Management Console](aws-management-console.png)

## Step 3 : Select the Region in which You Want to Set up Your Service

Please notice that most of the AWS services are regional-independent. That means that two services of the same particular kind in two different regions are completely isolated. The same applies to the Client VPN Endpoints. So we need to decide which region you want you deploy your service to. 

> Note that not all AWS regions provide Client VPN Endpoints.

### The AWS Regions where Client VPN Endpoints are Available

- US East (N. Virginia)
- US East (Ohio)
- US West (N. California)
- US West (Oregon)
- Asia Pacific (Mumbai)
- Asia Pacific (Seoul)
- Aisa Pacific (Singapore)
- Aisa Pacific (Sydney)
- Asia Pacific (Tokyo)
- Canada (Central)
- Europe (Frankfurt)
- Europe (Ireland)
- Europe (London)
- Europe (Stockholm)

And you can select the region from the list bar at the top right corner. Please do this **BEFORE** creating the endpoint.

![Select the region you prefer](region-selection.png)

### **How to select a region for your VPN Service?**

Usually, it highly depends on your current geolocation and that of the destination you want to access. For example, I am now living in Canada and wanting to access a Japanese video website that is exclusive to users in Japan. In that case, I would certainly select Asia Pacific (Tokyo) as my VPN region. 

Also, for a lot of Chinese users, the VPN is used to bypass the [GFW](https://en.wikipedia.org/wiki/Great_Firewall)(Great Firewall). So simply all the regions are suitable for this scenario, as the ones closer to China may have lower latencies. 

For simply encrypting the web traffic, the endpoint that is closest to you would be ideal as the latency is minimized.

## Step 4 : Create the certificates for clients and servers for AWS Certificate Manager

We need to create the certificates for both the clients and the servers. And we do this with the AWS Certificate Manager. We are going to first generate the keys and the certificates locally on our computer and then uploading them to the Certificate Manager via either the web console or AWS CLI. 

> For now, this article only demonstrates how to create keys and certificates on computers running **Unix-like systems**. For how to create keys and certificates for AWS Certificate Manager on Windows, see **[this page](https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/client-authentication.html#windows)**. 

**To generate the server and client certificates and keys and upload them to ACM(AWS Certificate Manager)**

1. Open your favorite terminal emulator and select a directory you want to use. Clone the OpenVPN `easy-rsa` repo to your local computer and navigate to the `easy-rsa/easyrsa3` folder. 

    `$ git clone https://github.com/OpenVPN/easy-rsa.git`

    `$ cd easy-rsa/easyrsa3`

2. Initialize a new PKI environment.

    `$ ./easyrsa init-pki`

3. Build a new certificate authority(CA).

    `$ ./easyrsa build-ca nopass`

    Follow the prompts to build the CA.

4. Generate the server certificate and key.

    `$  ./easyrsa build-server-full server nopass`

5. Generate the client certificate and key.

    > **Make sure to save the client certificate and key because you will need them later to configure the client.**

    `$ ./easyrsa build-client-full client1.domain.tld nopass`

6. Copy the server certificate and key and the client certificate and key to a custom folder and then navigate into the custom folder.   

    Before you copy the certificates and keys, create the custom folder by using the `mkdir` command. The following example creates a custom folder in your home directory. 

    ```bash
    $ mkdir ~/custom_folder/
    $ cp pki/ca.crt ~/custom_folder/
    $ cp pki/issued/server.crt ~/custom_folder/
    $ cp pki/private/server.key ~/custom_folder/
    $ cp pki/issued/client1.domain.tld.crt ~/custom_folder
    $ cp pki/private/client1.domain.tld.key ~/custom_folder/
    $ cd ~/custom_folder/
	```

7. Go to **AWS Certificate Manager** on the web console.

    ![Find Certification Manager](find-certificate-manager.png)

    Click on **"Get Started"**.

    ![Click Get Started](get-started-acm.png)

    Click on **"Import a certificate"**.

    ![Click Import a certificate](import-a-certificate-acm.png)

## Step 4 : Navigate to Client VPN Endpoint

Scroll down the page to find **"VPC"** under the category of **"Networking & Content Delivery"** and open the link. 

![the VPC item](vpc.png)

![the VPC console](vpn-console.png)

Find and open **"Client VPN Endpoints"** on the side panel on the left.

![Client VPN Endpoint](client-vpn-endpoint.png)

You should be on this page following the last action. 

![Client VPN Endpoint page](client-vpn-endpoint-page.png)